# 视窗的故事(一)

原文地址: [A tale of two viewports — part one](https://www.quirksmode.org/mobile/viewports.html)
---

> 在该迷你系列中我将阐释的内容分为视窗和多个重要元素标签是如何运作, 若同`<html>`元素, 同样还有`window`和`screen`.

当前内容是关于桌面浏览器的, 当然另外的目的是, 为移动端浏览器相似的讨论提供一个可见的不同阶段. 大部分web开发者早已凭借直觉思维理解了桌面涉及的内容。而在移动端存在相同的内容，但是更复杂。所以一种温习式的讨论，讨论每个人都已经熟知的知识和术语将会有很大的帮助去理解移动端浏览器。

## 设备像素和CSS像素

第一个需要理解的内容是CSS像素，以及它和设备像素的不同。

设备像素是一种我们凭借直觉认定是 "对的" 的像素。这种像素单位提供了一个标准方案，使在不同设备工作的我们有了一直的认知。这个属性可以从`screen.width/height`获得。

如果你给予一个确定的元素一个宽度`width: 128px`，同时你的显示器是1024px的宽度，也就是你的浏览器的最大显示宽度，这个确定的元素可以通过八次来铺满你的显示器(粗略的当成这个样子; 现在先忽略这些细节)。

如果使用浏览器的用户进行缩放，计算的结果也会发生变化。当缩放的结果是200%，那么宽度`width: 128px`的元素就会变成只需要四次就可以铺满1024px宽度的显示器。

缩放功能正如字面含义一样，在浏览器中它就是这样。实际的情况就是，元素的宽度并不是从128变成了256，取而代之的是真实像素变成了两倍。讲道理，确定的元素的宽度依然是128 CSS像素，即便真实像素变成了256像素。

换一种说法，既放大至200%使一个CSS像素增长了元素原有大小的四倍，参考真实像素的话。(两倍宽度，两倍高度，一共产生四倍面积大小)

使用一些图片来阐明这些内容。现在有4像素大小缩放比例为100%的设备像素栅格。实际上就这样; CSS像素的栅格完全覆盖设备像素的栅格。

![](https://www.quirksmode.org/mobile/pix/viewport/csspixels_100.gif)

现在试试缩小。CSS像素的栅格开始缩小，这意味着设备像素的栅格覆盖着多个CSS像素的栅格。

![](https://www.quirksmode.org/mobile/pix/viewport/csspixels_out.gif)

那么如果尝试放大的话，相反的情况就会发生。CSS像素的栅格会增大，一个CSS像素的栅格会覆盖多个设备像素的栅格。

![](https://www.quirksmode.org/mobile/pix/viewport/csspixels_in.gif)

这个的一个关键点就是_你唯一感兴趣的是CSS像素_。就是这种像素规定了你的样式如何去渲染。

设备像素几乎完全对你没什么用。当然对用户并不是; 用户会缩放页面知道页面阅读起来很舒适。不过缩放的比例的确和你没什么关系。浏览器会自动的适应并确保你的CSS图层跟随缩放进行变化。

## 100%的缩放比例
我从一个假设缩放比例为100%的例子开始。同时也是时候稍微更为正式和严格的定义一下如下内容:

> 在缩放比例为100%的情形下，一个CSS像素的确等于一个设备像素。

100%缩放比例的事实对于阐释接下来的内容是非常有用的，但是你也不用过于担心，它并不会对你的日常工作造成影响。通常情况在桌面环境你只会测试你的网站效果且缩放比例为100%，不过即便用户通过放大或者缩小，CSS像素的魔法也会确保你的图层保留相同的比例。

## 屏幕尺寸
首先让我们来做一些实际的度量。从 `screen.width` 和 `screen.height` 开始。他们的含义是用户屏幕的整个宽和高，测量的基础尺寸是设备像素，因为他们从来没有变化过。他们是显示器的特征，不是浏览器的。

很好，这很有意思! 所以我们能拿这个做些什么？

基本没什么用。用户显示器对于我们而言，并不重要。好吧，除非你想保存测量结果，存放在网络静态数据库中。

## 窗口大小
你想知道的是浏览器的内部尺寸大小。内部尺寸可以告诉你，你的布局对于当前用户有效部分。可以通过 `window.innerWidth` 和 `window.innerHeight` 获得这些数据。

![](https://www.quirksmode.org/mobile/pix/viewport/desktop_inner.jpg)

显然，内部窗口的宽度是基于CSS像素来进行测量的。你需要知道的事情是你的布局挤进窗口到底有多少。同时当用户放大的时候减少的数量。因为当用户放大时，窗口可用的空间变少了，而 `window.innerWidth/Height` 也相应的减少了。

(这里有个例外，也就是opera浏览器，它的 `innerWidth/Height` 不会减少，因为计算的基本单位是设备像素，这个情况在桌面环境只是让人比较困扰，一旦放在移动设备上便十分致命，稍后会再谈这个问题)

![](https://www.quirksmode.org/mobile/pix/viewport/desktop_inner_zoomed.jpg)

需要有一点需要注意的是，宽高的度量是包含了滚动条的。滚动条也被当作内部窗口的一部分(这可能是历史发展原因造成的)。

## 滚动偏移量
`window.pageXOffset` 和 `window.pageYOffset`，包含当前文档水平和垂直滚动偏移量，以此可以知道滚动的距离。

![](https://www.quirksmode.org/mobile/pix/viewport/desktop_page.jpg)

这些测量的基准是CSS像素。即不论如何所方，你都可以知道文档发生偏移的数值。

理论上，当滚动或者放大时，pageX/YOffset 都会发生变化。不过浏览器会保证可视部分顶部元素位置始终是一致的，当放大时，有时候也不会完全生效，也就意味着pageX/YOffset不会真正发生变化，滚动窗口边界的像素会大致保持一致。

![](https://www.quirksmode.org/mobile/pix/viewport/desktop_page_zoomed.jpg)

## 内容; 视窗
在讨论更多的javascript属性之前，必须先介绍另外一个内容: 视窗。

视窗的功能就是约束 `<html>` 元素，也就是处于网站最外层的容器。

这可能听起来模糊，那么先来一个练习的例子。假设你有一个流动布局，且其中边栏宽度为10% `width: 10%` 现在你调整窗口大小，边栏也整齐的增加或者减小，不过它到底怎么工作的？

从技术方面来看，所发生的事情就是边栏获得父元素的10%宽度，也就是 `<body>` (不过没设置宽度)。那么问题来了： `<body>`拥有的宽度是？

正常情况下，所有的块级元素都是从父元素获得100%的宽度(有例外，但现在忽略这个)，所以 `<body>` 的宽度是从 `<html>` 来的。

那么 `<html>` 的宽度是？为啥看起来和浏览器窗口宽度一样。同时这也是为什么你的样式`width: 10%`起作用，并使边栏占据整个浏览器窗口的10%。基本上所有的web开发者都凭借直觉了解并使用这个现象。

实际上，你可能不知道这个现象在理论上是如何工作的。`<html>`的宽度被视窗所限制，`<html>` 元素获得视窗100%的宽度。

作为视窗，反过来讲，的确等于浏览器窗口，也的确是如此定义的。视窗不是HTML结构，所以CSS对其没有影响，它只是和浏览器宽高相同，在桌面环境中如此。而在移动设备环境中会稍微复杂一点。

## 结论
这些事务状态可以得到一些很有趣的结论。你可以在但前站点看到他们其中之一。尽可能的滚动到顶部，然后发达两到三倍，让网站内容超出浏览器窗口。

现在滚动到最右边，你会看到在最顶部的蓝色横幅并没有对齐边界。

![](https://www.quirksmode.org/mobile/pix/viewport/desktop_htmlbehaviour.jpg)

这个行为就是一个关于视窗如何定义的结论。我给一个蓝色横幅定义宽度`width: 100%`。什么的100%? 当然是<html>元素，同视窗宽度一致，同样也同浏览器窗口宽度一致。

需要指出的是：在缩放程度为100%时，它工作的很好，现在我们放大视窗，网站的总宽度将会变小。这对于它自身来说没有什么影响，内容会溢出，但是元素具有属性`overflow: visible`, 意味着溢出的内容无论如何都会显示。

但是蓝色横幅并没有溢出。我定义了宽度10%，而且浏览器也遵循给出的视窗宽度。他们并不关心现在宽度表现的多糟糕。

![](https://www.quirksmode.org/mobile/pix/viewport/desktop_100percent.jpg)

## 文档宽度？

