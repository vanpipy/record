# 视窗的故事(二)

原文地址: [A tale of two viewports — part two](https://www.quirksmode.org/mobile/viewports2.html)
---

> 在该迷你系列中我将阐释的内容分为视窗和多个重要元素标签是如何运作, 比如`<html>`元素, 同样还有`window`和`screen`.

这个篇章呢，我们就开始聊聊移动设备中的浏览器。当然，如果你对于移动设备一筹莫展，那么我强烈建议首先阅读关于桌面浏览器的第一部分，以便于营造一种类似的学习环境。

# 问题? 移动设备中的浏览器
当我们将移动设备和桌面环境中的浏览器进行对比时，最明显的不同就是屏幕尺寸。移动设备中的浏览器展示一个经过桌面特性优化网站时，相比于桌面环境下的浏览器，那些优化点显著的减少；不论文字缩小到不可阅读的程度，还是只显示很小的一部分在屏幕中。

一个手机屏幕的尺寸远远小于桌面显示器；想想一下最宽只有400像素，甚至更窄。(有些手机供应商说他们的设备有更宽的尺寸，可惜他们都在撒谎 - 或者只给出一些无用的信息来混肴视听。)

平板设备的中间一部分，比如IPad或者可能存在基于HP的webOS系统开发的设备，都旨在弥合桌面设备和移动设备之间的空间，但是这种方式并没有改变根本的问题。网站一定，而且必然需要在移动设备中展示，所以我们得让网站在更小尺寸的屏幕中表现的一如既往的好才行。

最重要的问题集中在CSS中，特别是视窗的尺寸。假如我们完全按照桌面环境的样式模式，那样式将开始超出想象甚至很尴尬。

现在让我们回到宽度为10%的侧边栏。假如在移动设备的浏览器中也设置同样的属性，使这个元素的宽度最多为40像素，然后，那样就十分糟糕了。你可爱的流体布局可能看起来被挤压到了一堆。

其中一个解决方式是为移动设备专门构建一个特殊的网站。不过，除了你是否应该这样做的基本问题，实际的问题是只有很少的站点拥有者对移动设备做了足够的适配。

手机浏览器供应商想为他们的客户提供尽可能好的体验，就是现在通俗意义上描述“尽可能的像桌面环境”一样。于是一些奇诡的手段就成为了必要的了。

# 两个视窗
所以这个视窗作为你的样式布局的基础就特别糟糕。最明显的解决办法就是让视窗变的更宽。如此这么做，怎么说呢，需要划分成两类：虚拟视窗和布局视窗。

George Commins 对这类基础内容做出了[最棒的解释](https://stackoverflow.com/questions/6333927/difference-between-visual-viewport-and-layout-viewport)在 Stack Overflow：

> 想象一下，把布局视窗当成一个很大的图片，一个不会改变尺寸和形状的图片。现在想象你有一个更小一点的框框，可以通过它去观察那个很大的图片。这个稍小的框框被一圈不透明材质包围，这圈不透明的材质会模糊并阻止你看到很大图片的整个部分除了没有覆盖的地方。现在在很大的图片中你可以透过框框看到的那一部分，就是虚拟视窗。当你的框框稳定在一个位置的时候(缩小)，你可以尝试离很大图片远一点，去快速的看到整个图片，或者可以尝试走得更近一点(放大)，然后看到仅仅很小一部分。你同样也可以改变框框的方向，可是那个很大的图片(布局视窗)的尺寸和形状并不会改变。

也可以看一下 Chris 的[解释](https://stackoverflow.com/questions/7344886/visual-viewport-vs-layout-viewport-on-mobile-devices)。

虚拟视窗就是在当前页面显示在屏幕中的那一部分。用户可以通过滚动去改变他看到的内容，或者通过缩放去改变虚拟视窗的尺寸。

![](https://www.quirksmode.org/mobile/pix/viewport/mobile_visualviewport.jpg)

无论如何，样式布局，特别是那些百分比的宽度，都是相对于布局视窗来计算的，更多的情况下布局视窗总是比虚拟视窗更宽。

因此 `<html>` 元素一开始使用布局视窗的宽度，你的样式就是如此解读的，就好像屏幕看起来很明显的比手机屏幕宽很多。这样就确保你的网站的布局行为表现的样子就如同桌面浏览器一样。

布局视窗的宽度是多少? 这个数据可能每个浏览器都不一样。Safari IPhone 使用980像素，Opera是850像素，Android WebKit是800像素，然后IE是974像素。

同时有些浏览器还有一些奇特的操作：

+ Symbian WebKit 会尝试保持布局视窗全等于虚拟视窗，是的，这样就意味着百分比宽度的元素会表现的很奇怪。不过怎么说呢，要是整个页面不适应绝对宽度的虚拟视窗的话，浏览器就会把布局视窗拉伸到850像素的最大宽度。

+ Samsung WebKit (bada) 的布局视窗会保持同最宽的那个元素一样的宽度。

+ 在 BlackBerry 中，布局视窗，在100%的缩放比例下，等于虚拟视窗。这好像没啥变化。

# 缩放
显然，所有的视窗衡量的单位都是样式像素。但是当虚拟视窗通过缩放改变的时候(如果你放大，CSS像素将会更少的出现在屏幕中)，而布局视窗的尺寸仍然一样。(要是他们不这样，你的页面会不断按照重新计算的百分比宽度进行重排。)

# 理解布局视窗
为了理解布局视窗的尺寸是什么，我们得先看看当缩小到最小程度时候发生了什么。许多手机上的浏览器一开始都最大程度的缩小模式不管展示什么内容。

重点是：浏览器选择了他们的布局视窗的尺寸，这样就完全的覆盖了整个屏幕在最大程度的缩小模式下(这个时候就等于虚拟视窗)

![](https://www.quirksmode.org/mobile/pix/viewport/mobile_viewportzoomedout.jpg)

因此布局视窗的宽和高就等于在最大程度的缩小模式下的任何展示在屏幕里的内容。即便是用户放大这些尺寸也保持一样。

![](https://www.quirksmode.org/mobile/pix/viewport/mobile_layoutviewport.jpg)

布局视窗的宽度总是一样的。如果你旋转你的手机，虚拟视窗发生了改变，但是浏览器会稍微的放大一下去适应新的方向，于是布局视窗又再次保持和虚拟视窗一样的宽度了。

![](https://www.quirksmode.org/mobile/pix/viewport/mobile_viewportzoomedout_la.jpg)

这样会影响布局视窗的高度，视窗的高度远远小于纵向模式的高度。但是Web开发者根本不关心这个高度，只关心宽度。

![](https://www.quirksmode.org/mobile/pix/viewport/mobile_layoutviewport_la.jpg)

# 如何测量布局视窗的尺寸
现在有两种视窗的尺寸需要我们去测量。然后非常幸运的是，浏览器大战给予了我们两对这样的属性。

`document.documentElement.clientWidth`和`-Height`包含了布局视窗的尺寸。

![](https://www.quirksmode.org/mobile/pix/viewport/mobile_client.jpg)

屏幕方向和高度紧密相关，跟宽度没什么联系。

![](https://www.quirksmode.org/mobile/pix/viewport/mobile_client_la.jpg)

# 如何测量虚拟视窗的尺寸
对于虚拟视窗而言，可以使用 `window.innerWidth/Height`来获取相应的尺寸。显然的，当用户尝试进行缩放操作的时候，这个测量结果是会变化的，因为可能有更多或者更少的CSS像素点填充在屏幕中。

![](https://www.quirksmode.org/mobile/pix/viewport/mobile_inner.jpg)

可惜的是，这里是一个尚未获得兼容的区域；许多浏览器依然保持了对虚拟视窗测量功能的支持，同时还有一些浏览器没有这样的测量功能支持，所以我估计 `window.innerWidth/Height` 算是一个标准，尽管是一个比较糟糕的支持属性。

# 屏幕
在桌面设备中，`screen.width/height` 给出了屏幕的尺寸，基于设备像素的基本单位。当然在桌面环境中，作为一个开发者你根本不需要这样的信息。你对屏幕的物理尺寸也根本不感兴趣，除了有多少CSS像素填充在屏幕中。

![](https://www.quirksmode.org/mobile/pix/viewport/mobile_screen.jpg)

# 缩放比例
TODO